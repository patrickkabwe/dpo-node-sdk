"use strict";var k=Object.create;var y=Object.defineProperty;var g=Object.getOwnPropertyDescriptor;var D=Object.getOwnPropertyNames;var I=Object.getPrototypeOf,A=Object.prototype.hasOwnProperty;var w=(o,t)=>{for(var e in t)y(o,e,{get:t[e],enumerable:!0})},O=(o,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of D(t))!A.call(o,n)&&n!==e&&y(o,n,{get:()=>t[n],enumerable:!(r=g(t,n))||r.enumerable});return o};var L=(o,t,e)=>(e=o!=null?k(I(o)):{},O(t||!o||!o.__esModule?y(e,"default",{value:o,enumerable:!0}):e,o)),G=o=>O(y({},"__esModule",{value:!0}),o);var S={};w(S,{DPOPayment:()=>d});module.exports=G(S);var b=L(require("axios")),h=b.default.create({baseURL:process.env.DPO_BASE_URL||"https://secure.3gdirectpay.com/API",headers:{"Content-Type":"application/xml"}});var c=class extends Error{code;constructor(t,e=0){super(t),this.name="DPOError",this.code=e}};var j=require("axios");function P(o){return o.replace(/[\s_-]+(\w)/g,function(t,e){return e.toUpperCase()}).replace(/(?:^\w|[A-Z]|\b\w)/g,function(t,e){return e===0?t.toLowerCase():t.toUpperCase()}).replace(/\s+/g,"")}var R=require("fast-xml-parser"),f=o=>new R.XMLParser().parse(o);var m=(o,t=!0)=>{let e=f(o),r=e.API3G?.StatusCode||e.API3G?.Result,n=e.API3G?.ResultExplanation||"success",i=Object.entries(e.API3G).map(([p,a])=>{if(typeof a=="object"&&a!==null){let T=Object.entries(a).map(([u,l])=>({[P(u)]:l})).reduce((u,l)=>({...u,...l}));return{[P(p)]:T}}return{[P(p)]:a}}).reduce((p,a)=>({...p,...a}));switch(t&&(delete i.result,delete i.resultExplanation),r){case 0:case 130:case 900:case"success":return{...i,statusCode:200,message:n};default:return{...i,statusCode:400,message:n}}};var s=o=>{if((0,j.isAxiosError)(o)){delete o.response?.data["?xml"];let t=m(o.response?.data);throw new c(t,o.response?.status)}throw o};var C=require("fast-xml-parser"),x=o=>`<?xml version="1.0" encoding="utf-8"?>${new C.XMLBuilder().build(o)}`;var d=class{companyToken;apiVersion;baseURL;constructor({companyToken:t,apiVersion:e="v6"}){this.companyToken=t,this.apiVersion=e,this.baseURL=process.env.DPO_BASE_URL||"https://secure.3gdirectpay.com/API"}async processPaymentResponse(t){let e=x(t),r=await h.post(`/${this.apiVersion}/`,e);delete r.data["?xml"];let n=m(r.data);if(n.statusCode!==200)throw new c(JSON.stringify(n),n.statusCode);return n}async initiatePayment(t){try{let e={API3G:{CompanyToken:this.companyToken,Request:"createToken",...t}},r=await this.processPaymentResponse(e);return{...r,paymentURL:`${this.baseURL}?ID=${r.transToken}`}}catch(e){return s(e)}}chargeMobilePayment(t){try{let e={API3G:{CompanyToken:this.companyToken,Request:"chargeTokenMobile",...t}};return this.processPaymentResponse(e)}catch(e){return s(e)}}chargeCardPayment(t){try{let e={API3G:{CompanyToken:this.companyToken,Request:"chargeTokenCreditCard",...t}};return this.processPaymentResponse(e)}catch(e){return s(e)}}refundPayment(t){try{let e={API3G:{CompanyToken:this.companyToken,Request:"refundToken",...t}};return this.processPaymentResponse(e)}catch(e){return s(e)}}cancelPayment(t){try{let e={API3G:{CompanyToken:this.companyToken,Request:"cancelToken",...t}};return this.processPaymentResponse(e)}catch(e){return s(e)}}checkPaymentStatus(t){try{let e={API3G:{CompanyToken:this.companyToken,Request:"verifyToken",...t}};return this.processPaymentResponse(e)}catch(e){return s(e)}}parseWebhookXML(t){return m(t,!1)}};0&&(module.exports={DPOPayment});
